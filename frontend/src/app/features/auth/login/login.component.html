<div class="login-shell min-h-screen flex items-center justify-center">
  <div class="login-card w-full max-w-md rounded-lg p-8" role="region" aria-label="Formulario de inicio de sesiÃ³n">

    <!-- Logos (dos marcas con divisor) -->
  <!-- Logo Ãºnico con control de tamaÃ±o -->
<div class="flex justify-center mb-6">
  <div class="logo-wrap" role="img" aria-label="Logo Sanmarino TecnologÃ­a e InnovaciÃ³n">
    <img
      src="assets/brand/icono-logo.png"
      alt="Sanmarino TecnologÃ­a e InnovaciÃ³n"
      class="logo-img"
      loading="eager"
      decoding="async"
    />
  </div>
</div>


    <form [formGroup]="loginForm" (ngSubmit)="onSubmit()" class="space-y-4" novalidate>
      <!-- Error global con tipos especÃ­ficos -->
      <div *ngIf="errorMsg" class="alert-error" [ngClass]="{
        'alert-error--database': errorType === 'database',
        'alert-error--network': errorType === 'network',
        'alert-error--blocked': errorType === 'blocked',
        'alert-error--credentials': errorType === 'credentials',
        'alert-error--encryption': errorType === 'encryption'
      }" role="alert">
        <div class="error-header">
          <strong *ngIf="errorType === 'database'">ğŸ”´ Error de Base de Datos:</strong>
          <strong *ngIf="errorType === 'network'">ğŸŒ Error de ConexiÃ³n:</strong>
          <strong *ngIf="errorType === 'blocked'">ğŸš« Acceso Bloqueado:</strong>
          <strong *ngIf="errorType === 'credentials'">ğŸ” Credenciales InvÃ¡lidas:</strong>
          <strong *ngIf="errorType === 'encryption'">ğŸ”’ Error de Seguridad:</strong>
          <strong *ngIf="!errorType || errorType === 'unknown'">âš ï¸ Error:</strong>
        </div>
        <div class="error-message">{{ errorMsg }}</div>
      </div>

      <!-- Email -->
      <div class="field">
        <label for="email" class="label">Email</label>
        <input
          id="email"
          type="email"
          formControlName="email"
          placeholder="you@example.com"
          class="brand-input"
          autocomplete="username email"
          inputmode="email"
          [attr.aria-invalid]="loginForm.get('email')?.invalid && loginForm.get('email')?.touched"
          required
        />
        <div *ngIf="loginForm.get('email')?.touched && loginForm.get('email')?.invalid" class="hint-error" role="status" aria-live="polite">
          <div *ngIf="loginForm.get('email')?.errors?.['required']">El email es obligatorio.</div>
          <div *ngIf="loginForm.get('email')?.errors?.['email']">Email no vÃ¡lido.</div>
        </div>
      </div>

      <!-- ContraseÃ±a -->
      <div class="field">
        <label for="password" class="label">ContraseÃ±a</label>
        <input
          id="password"
          type="password"
          formControlName="password"
          placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
          class="brand-input"
          autocomplete="current-password"
          [attr.aria-invalid]="loginForm.get('password')?.invalid && loginForm.get('password')?.touched"
          required
        />
        <div *ngIf="loginForm.get('password')?.touched && loginForm.get('password')?.invalid" class="hint-error" role="status" aria-live="polite">
          <div *ngIf="loginForm.get('password')?.errors?.['required']">La contraseÃ±a es obligatoria.</div>
          <div *ngIf="loginForm.get('password')?.errors?.['minlength']">
            MÃ­nimo {{ loginForm.get('password')?.errors?.['minlength'].requiredLength }} caracteres.
          </div>
        </div>
      </div>

      <!-- Recordarme -->
      <label class="remember">
        <input type="checkbox" formControlName="remember" class="remember__control" />
        <span class="remember__label">Recordarme</span>
      </label>

      <!-- reCAPTCHA (solo en producciÃ³n) -->
      <div *ngIf="recaptchaEnabled && recaptchaSiteKey" class="recaptcha-container">
        <re-captcha
          [siteKey]="recaptchaSiteKey"
          (resolved)="onRecaptchaResolved($event)"
          (error)="onRecaptchaError()"
          formControlName="recaptchaToken"
        ></re-captcha>
        <div *ngIf="loginForm.get('recaptchaToken')?.touched && loginForm.get('recaptchaToken')?.invalid"
             class="hint-error" role="status" aria-live="polite">
          Por favor, completa la verificaciÃ³n de seguridad.
        </div>
      </div>

      <!-- BotÃ³n -->
      <button
        type="submit"
        class="brand-btn"
        [disabled]="loginForm.invalid || loading"
        aria-label="Entrar"
      >
        <span *ngIf="!loading">Entrar</span>
        <span *ngIf="loading" class="loading-content">
          <span class="spinner"></span>
          Procesando...
        </span>
      </button>

      <!-- Mensaje de carga extendido -->
      <div *ngIf="loading" class="loading-message" role="status" aria-live="polite">
        <p>Iniciando sesiÃ³n...</p>
        <p class="loading-subtitle">Desencriptando datos y cargando informaciÃ³n...</p>
      </div>

      <!-- Enlace de recuperaciÃ³n de contraseÃ±a -->
      <div class="forgot-password">
        <button type="button" class="link-button" (click)="goToPasswordRecovery()">
          Â¿Olvidaste tu contraseÃ±a?
        </button>
      </div>

        <img
          src="assets/brand/italcol-blanco.png"
          class="logo-img-accent "
          loading="eager"
          decoding="async"
        />
    </form>
  </div>
</div>

<footer class="site-footer" role="contentinfo">
  <div class="footer-inner">
    <span>Â© {{ today | date:'yyyy' }} Sanmarino GenÃ©tica AvÃ­cola</span>
    <span class="dot">â€¢</span>
    <span>Todos los derechos reservados</span>
  </div>
</footer>
